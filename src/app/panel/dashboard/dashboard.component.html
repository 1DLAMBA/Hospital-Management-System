<p-toast  [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>
<p-dialog 
header="Edit Profile" 
[modal]="true"
[(visible)]="visible" 
[style]="{ width: '25rem' }">
    <span class="p-text-secondary block mb-5">
        Update your information.
    </span>
    
    <div class="flex justify-content-end gap-2">
        <p-button label="Cancel" severity="secondary" (onClick)="visible = false" />
        <p-button label="Save" (onClick)="visible = false" />
    </div>
</p-dialog>
<div class=" holder">

    <app-side-nav></app-side-nav> 

    <!-- MAIN PANEL -->
    <div class="header">
        <div class="d-flex   d-ovr justify-content-between p-3">
            <h4>Dashboard Overview</h4>
            <div class="d-flex">
                <div class="passport">
                    <img  src="{{ avatar_file + (user?.passport || '') }}" *ngIf="user">
                </div>
                <div *ngIf="user">

                    <p><b>{{user?.name}}</b></p>
                    <div class="d-flex gap-5">
                        <small>{{user?.user_type}}</small>
                        <div class="d-flex ">
                            <!-- Bell button toggles the notification tray -->
                            <button style="border: 0; background-color: white;" (click)="toggleNotifications($event, notifPanel)" pBadge [value]="newNotificationBatch ? '1' : ''">
                                <i class="bi bi-bell text-3xl"></i>
                            </button>
                            <!-- Logout button -->
                            <button style="border: 0; background-color: white; margin-left: 10px;" (click)="logout()" title="Logout">
                                <i class="bi bi-box-arrow-right text-3xl"></i>
                            </button>
                            
                            <!-- Notification Tray -->
                            <p-overlayPanel #notifPanel [showCloseIcon]="false" [dismissable]="true" [style]="{width: '360px', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)'}">
                                <div class="notification-panel">
                                    <div class="notification-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center gap-2">
                                                <i class="bi bi-bell"></i>
                                                <h6 class="mb-0">Notifications</h6>
                                                <span class="notification-count" *ngIf="notifications?.length">{{ notifications.length }}</span>
                                            </div>
                                            <button class="notification-close" (click)="notifPanel.hide()" type="button">
                                                <i class="bi bi-x-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="notification-body">
                                        <ng-container *ngIf="notifications?.length; else noNotifs">
                                            <ul class="notification-list">
                                                <li *ngFor="let n of notifications; let last = last" class="notification-item" [class.unread]="!n.read">
                                                    <div class="notification-content">
                                                        <div class="notification-icon">
                                                            <i class="bi bi-envelope"></i>
                                                        </div>
                                                        <div class="notification-details">
                                                            <div class="notification-title">{{ n.title }}</div>
                                                            <div class="notification-message">{{ n.message }}</div>
                                                            <div class="notification-time">{{ n.time | date:'MMM d, h:mm a' }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="notification-indicator" *ngIf="!n.read"></div>
                                                    <div class="notification-divider" *ngIf="!last"></div>
                                                </li>
                                            </ul>
                                        </ng-container>
                                        <ng-template #noNotifs>
                                            <div class="notification-empty">
                                                <p class="mb-0">No notifications</p>
                                            </div>
                                        </ng-template>
                                    </div>
                                </div>
                            </p-overlayPanel>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="user?.user_type=='doctor'" class="d-flex mob-head  justify-content-between p-1">
            <a routerLink="my-profile/doctor/{{this.id}}" class="text-decoration-none">

                <button class="navi d-flex p-2">
                    
                    <p class="m-1 fw-bold bi bi-activity" style="font-size:xx-large;"></p>
                    <p class="m-auto" style="font-size: smaller;"  ><b>{{user?.name}}</b></p>
    
                </button>
            </a>
            <div class="d-flex">
                <div class="passport">
                    <img  src="{{ avatar_file + (user?.passport || '') }}">
                </div>
                
            </div>
        </div>
        <div *ngIf="user?.user_type=='client'" class="d-flex mob-head  justify-content-between p-1">
            <a routerLink="my-profile/client/{{this.id}}" class="text-decoration-none">

                <button class="navi d-flex p-2">
                    
                    <p class="m-1 fw-bold bi bi-activity" style="font-size:xx-large;"></p>
                    <p class="m-auto" style="font-size: smaller;"  ><b>{{user.name}}</b></p>
    
                </button>
            </a>
            <div class="d-flex">
                <div class="passport">
                    <img  src="{{ avatar_file + user.passport }}">
                </div>
                
            </div>
        </div>
        <div *ngIf="user?.user_type=='nurse'" class="d-flex mob-head  justify-content-between p-1">
            <a routerLink="my-profile/nurse/{{this.id}}" class="text-decoration-none">

                <button class="navi d-flex p-2">
                    
                    <p class="m-1 fw-bold bi bi-activity" style="font-size:xx-large;"></p>
                    <p class="m-auto" style="font-size: smaller;"  ><b>{{user.name}}</b></p>
    
                </button>
            </a>
            <div class="d-flex">
                <div class="passport">
                    <img  src="{{ avatar_file + user.passport }}">
                </div>
                
            </div>
        </div>
        <div class="">

            <router-outlet></router-outlet>
        </div>
    </div>   
    <!-- ADD NG IF HERE TO CHECK USER TYPE BEFORE RENDERING MOBILE NAV -->
    <div *ngIf="user?.user_type=='doctor'" class="mob-nav">
        <a routerLinkActive="active"  [routerLinkActiveOptions]={exact:true}  class="bi bi-columns-gap" routerLink="doctor-panel/{{this.id}}">
            
        </a>
        <a routerLinkActive="active"  class="bi bi-prescription2" routerLink="doctor-appointment">

        </a>
        <a routerLinkActive="active"  class=" bi bi-heart-pulse-fill" routerLink="nurses">

        </a>
        <a routerLinkActive="active"  class="bi bi-chat-right-text-fill" routerLink="messages">

        </a>
        <a routerLinkActive="active"  class="bi bi-robot" routerLink="medical-ai">
            <span>AI</span>
        </a>
    </div>
    <div *ngIf="user?.user_type=='nurse'" class="mob-nav">
        <a routerLinkActive="active"  [routerLinkActiveOptions]={exact:true}  class="bi bi-columns-gap" routerLink="nurse-panel">
            
        </a>
        <a routerLinkActive="active"  class="bi bi-prescription2" routerLink="assignment">

        </a>
    
        <a routerLinkActive="active"  class="bi bi-chat-right-text-fill" routerLink="messages">

        </a>
        <a routerLinkActive="active"  class="bi bi-robot" routerLink="medical-ai">
            <span>AI</span>
        </a>
    </div>
    <div *ngIf="user?.user_type=='client'" class="mob-nav">
        <a routerLinkActive="active"  [routerLinkActiveOptions]={exact:true}  class="bi bi-columns-gap" routerLink="client-panel">
            
        </a>
        <a routerLinkActive="active"  class="bi bi-prescription2" routerLink="client-appointment">

        </a>
        <a routerLinkActive="active"  class=" bi bi-heart-pulse-fill" routerLink="doctors">

        </a>
        <a routerLinkActive="active"  class="bi bi-chat-right-text-fill" routerLink="messages">

        </a>
        <a routerLinkActive="active"  class="bi bi-robot" routerLink="medical-ai">
            <span>AI</span>
        </a>
    </div>
</div>
