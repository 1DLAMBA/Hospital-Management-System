<main class="d-flex flex-column">

    <section class="hero p-3">

        <!-- <p>{{user.clients.user.name}}</p> -->
    </section>

    <section class="main mx-auto d-flex justify-content-between">
        <div class="left-profile">
            <div class="profile-header-section">
                <div class="avatar-wrapper">
                    <img [src]="user?.passport ? (avatar_file + user?.passport) : defaultAvatar" 
                         [alt]="user?.name" 
                         (error)="handleImageError($event)">
                </div>
                <h2 class="profile-name">{{user.name}}</h2>
            </div>

            <div class="profile-section">
                <h3 class="section-title">Patient Details</h3>
                <div class="info-row">
                    <span class="info-label">Date of Birth</span>
                    <span class="info-value">{{user.clients.date_of_birth | date}}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Gender</span>
                    <span class="info-value">{{user.gender}}</span>
                </div>
            </div>

            <div class="profile-section">
                <h3 class="section-title">Contact Information</h3>
                <div class="info-row">
                    <span class="info-label">Phone</span>
                    <span class="info-value">{{user.phoneno}}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email</span>
                    <span class="info-value email-value">{{user.email}}</span>
                </div>
            </div>

            <div class="profile-actions d-flex gap-2">
                <p-button label="Edit Profile" (click)="showDialog()" severity="info" [raised]="true" [rounded]="true" />
                <p-button label="Logout" icon="pi pi-sign-out" severity="danger" [raised]="true" [rounded]="true" (click)="logout()" />
            </div>
        </div>
        <div class="right-profile">
            <div class="p-2 subs-holder" *ngIf="user.clients.appointments" >
                <div *ngIf="user.clients.appointments.status=='Accepted'" class="">
                    <b>Current Appointment</b>
                   
                    <div class="d-flex justify-content-between m-1">
                        <div class="">
    
                            <span >Patient Complaints:</span> <p class="text-secondary">{{user.clients.appointments.symptoms}}</p>
                        </div>
                        <div class="">
                            <span >Date:</span> <p class="text-secondary">{{user.clients.appointments.date_time | date}}</p>
                        </div>
                        <div *ngIf="user.clients.appointments?.doctor" class="">
                            <span >Doctor:</span> <p class="text-secondary">{{user.clients.appointments?.doctor?.user.name }}</p>
                        </div>
                        <div *ngIf="user.clients.appointments?.other_professional" class="">
                            <span >Other Professional:</span> <p class="text-secondary">{{user.clients.appointments?.other_professional?.user.name }}</p>
                        </div>
                        <div class=" hold3">
                            <span class="fs-6" >Status:</span> 
                            <p-tag [rounded]="true" severity="success" value="{{user.clients.appointments.status}}"></p-tag>

                        </div>
                    </div>
                </div>
                <div *ngIf="user.clients.appointments.status=='pending' && appointment" >
                    <b>Current Appointment</b>
                   
                    <div class="d-flex justify-content-between m-1">
                        <div class="">
    
                            <span >Patient Complaints:</span> <p class="text-secondary">{{user.clients.appointments.symptoms}}</p>
                        </div>
                        <div class="">
                            <span >Date:</span> <p class="text-secondary">{{user.clients.appointments.date_time | date}}</p>
                        </div>
                        <div class="">
                            <span >Doctor:</span> <p class="text-secondary">{{user.clients.appointments?.doctor?.user.name }}</p>
                        </div>
                        <div *ngIf="user.clients.appointments?.other_professional" class="">
                            <span >Other Professional:</span> <p class="text-secondary">{{user.clients.appointments?.other_professional?.user.name }}</p>
                        </div>
                        <div class=" hold3">
                            <span class="fs-6" >Status:</span> 
                            <p-tag [rounded]="true" severity="warning" value="{{user.clients.appointments.status}}"></p-tag>

                        </div>
                    </div>
                   
                </div>
                <div *ngIf="user.clients.appointments.status=='Declined' || !user.clients.appointments ||user.clients.appointments.status=='pending' || !user.clients.appointments" class="">
                    <p>No pending appointment</p>
                </div>
            </div>
            <div class="m-2">
                <h1 class="primary-color">Medical Records</h1>
                <p-table #dt1 dataKey="id" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]" [paginator]="true"
                [value]="medicalRecords"  [globalFilterFields]="['nurse.user.name', 'nurses.specialization', 'representative.name', 'status']">


                  <ng-template pTemplate="caption">
                      <div class="d-flex justify-content-between">
                          <p-button pRipple label="Clear" size="small" [outlined]="true" icon="pi pi-filter-slash" />
                          
                      </div>
                  </ng-template>
                  <ng-template pTemplate="header">
                      <tr>
                          <th style="min-width:7rem">
                              <div class="flex align-items-center">
                                  View
                                  <!-- <p-columnFilter type="text" field="name" display="menu" /> -->
                              </div>
                          </th>

                          <th style="min-width:10rem">
                              <div class="flex align-items-center">
                                  Diagnosis
                              </div>
                          </th>
                          <th style="min-width:15rem">
                              <div class="flex align-items-center">
                                  Treatment
                              </div>
                          </th>

                          <th style="min-width:10rem">
                              <div class="flex align-items-center">
                                  Doctor
                              </div>
                          </th>

                      </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-medicalRecords>
                      <tr>
                          <td>
                              <p-button label="View" severity="info" [raised]="true"  [rounded]="true" (click)="openMedRecordView(medicalRecords)" />
                          </td>
                          <td class="d-flex">
                              {{medicalRecords?.diagnosis}}
                          </td>
                          <td>
                              {{medicalRecords?.treatment}}

                              <!-- <img src="https://primefaces.org/cdn/primeng/images/demo/flag/flag_placeholder.png" [class]="'flag flag-' + nurses.country.code" style="width: 20px" /> -->
                              <!-- <span class="ml-1 vertical-align-middle">{{ client.user.phoneno }}</span> -->
                          </td>

                          <td>
                              {{medicalRecords?.doctor?.user?.name || medicalRecords?.other_professional?.user?.name }}

                          </td>


                      </tr>
                  </ng-template>
                  <ng-template pTemplate="emptymessage">
                      <tr>
                          <td colspan="7">No medical records found.</td>
                      </tr>
                  </ng-template>


              </p-table>
            </div>
            
            

           
           

        </div>
    </section>
</main>

<!-- Medical Record View Component -->
<app-medical-record-view 
  [medicalRecord]="selectedMedRecord" 
  [client]="user?.clients"
  [(visible)]="viewMedRecordDialog">
</app-medical-record-view>